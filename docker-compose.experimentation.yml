services:
  ollama:
    image: ollama/ollama:latest
    container_name: ollama
    restart: unless-stopped
    expose:
      - "11434"
    volumes:
      - ollama-data:/root/.ollama
    healthcheck:
      test: ["CMD", "ollama", "list"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - ollama-net

  llm-eval:
    build:
      context: .
      dockerfile: experimentation/Dockerfile
    image: phishing-llm-eval:latest
    container_name: llm-eval
    restart: unless-stopped
    depends_on:
      ollama:
        condition: service_healthy
    environment:
      - OLLAMA_HOST=http://ollama:11434
    working_dir: /app/experimentation
    command:
      [
        "python",
        "ollama_llm_eval.py",
        "--csv-path",
        "/app/data/enron_data_fraud_labeled.csv",
        "--target-rows",
        "10000",
        "--model",
        "deepseek-r1:1.5b",
        "--log-every",
        "1",
      ]
    volumes:
      - ./experimentation/data:/app/data:ro
      - ./experimentation/llm_results.csv:/app/experimentation/llm_results.csv
    networks:
      - ollama-net

volumes:
  ollama-data:

networks:
  ollama-net:
    driver: bridge
